<nav class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collarse" data-target=".navbar-collapsed">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="">TrainingTrack</a>
		</div>
		<div class="collapse navbar-collapse" id="navigationBar">
			<ul class="nav navbar-nav">
				<% if (user) { %> 
				
				<li class="active"><a href="">Trainings</a></li>
				
				<% } %>
			</ul>

			<% if (user) { %>

			<div class="navbar-right">
				<p class="navbar-text">Hi, <%- user.username %> </p>
				<button id="logoutBtn" type="button" class="btn btn-default navbar-btn">Log out</button>
			</div>

			<% } else { %>

			<div class="navbar-right">
				<button type="button" class="btn btn-default navbar-btn" data-toggle="modal" data-target=".bs-example-modal-sm">Log In</button>
			</div>

			<% } %>
		</div>

	</div>
</nav>

<div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" id="loginModal">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        <h4 class="modal-title">Log In</h4>
		     </div>
		    <div class="modal-body">
		    	<form class="form-horizontal" name="login-form">
				  <div class="form-group">
				    <label for="inputEmail3" class="col-sm-2 control-label">Username</label>
				    <div class="col-sm-10">
				      <input type="text" class="form-control" id="inputEmail3" placeholder="Username" name="username">
				    </div>
				  </div>
				  <div class="form-group">
				    <label for="inputPassword3" class="col-sm-2 control-label">Password</label>
				    <div class="col-sm-10">
				      <input type="password" class="form-control" id="inputPassword3" placeholder="Password" name="password">
				    </div>
				  </div>
				  <div class="form-group">
				    <div class="col-sm-offset-2 col-sm-10">
				      <button type="submit" class="btn btn-default">Sign in</button>
				    </div>
				  </div>
				</form> 
		    </div>
			
		</div>	
	</div>
</div>
<script>

$(document.forms['login-form']).on('submit', function() {
	var form = $(this);

    //$('.error', form).html('');
    //$(":submit", form).button("loading");

    $.ajax({
		url: "/login",
		method: "POST",
		data: form.serialize(),
		complete: function() {
			$(":submit", form).button("reset");
		},
		statusCode: {
			200: function() {
			  //form.html("Вы вошли в сайт").addClass('alert-success');
			  $('#loginModal').modal('hide');

			  window.location.href = "/personal";
			},
			403: function(jqXHR) {
			  var error = JSON.parse(jqXHR.responseText);
			  //$('.error', form).html(error.message);
			}
		}
	});
	return false;
});

$("#logoutBtn").click(function() {
	$.ajax({
	    url: "/logout",
	    method: "POST"
	}).success(function() {
		window.location.href = "/";
	});
});

</script>